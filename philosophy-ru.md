# Философия проекта

## 1. Исходная проблема

С распространением ИИ-агентов для разработки возникла проблема:

- С одной стороны — агента очень легко установить, и он может быстро написать работающий код, это выглядит как магия
- С другой стороны — агент может уничтожить весь проект, внести правки которые ломают работающий код и больше не сможет их исправить, поломать всю ситему

Ключевая причина риска:

ИИ-агент — это не разумная система с пониманием последствий, а вероятностная модель. Он выполняет статистически правдоподобные действия, и как бы его не тренировали "быть безопасным" - до конца он никогда безопасным не будет.

Следствие:

Даже при наличии встроенных песочниц (cgroups, внутренние чекпоинты и т.п.) нельзя исключить:

- джейлбрейки через внешние источники,
- генерацию вредоносного кода,
- попытки выхода из ограничений,
- ошибочные правки кода с невозможностью вернуть всё как было,
- уничтожение всего проекта не находящегося в git и не имеющего резервных копий
- неконтролируемое потребление ресурсов.

Исходим из предположения, что ИИ-агент является опасным по умолчанию, и не надеемся на его внутренние ограничения

---

## 2. Целевая аудитория

Проект ориентирован на:

- обычных разработчиков,
- ИИ-энтузиастов,
- пользователей, не готовых разбираться в тонкостях контейнеризации и ручной настройки бэкапов.

Принцип:

Установка и безопасное использование агента должно быть почти таким же простым, как  
`npm install codex` / `npm install qwen-code` / `npm install claude-code`,  
но при этом существенно надёжнее стандартного способа запуска.

---

## 3. Архитектурный выбор: виртуальная машина как базовая единица безопасности

Контейнеры (Docker, LXC, LXD) были сознательно исключены как основа системы по следующим причинам:

- контейнеры используют общее ядро хоста;
- изоляция слабее, чем у полноценной VM;
- возможны ошибки конфигурации;
- конфликты ограничений (cgroups агента vs cgroups Docker);
- нестабильность и побочные эффекты на основной системе.

### 3.1. Контейнеры — это целевая среда разработки

В современном процессе разработки Docker является стандартом сборки и доставки ПО. Нормальный сценарий для агента:

- сгенерировать `Dockerfile`,
- создать `docker-compose.yml`,
- собрать образы,
- запустить контейнеры,
- проверить работоспособность.

Если агент работает внутри контейнера, возникает проблема:

- запуск Docker внутри Docker требует привилегированного режима;
- либо требуется проброс Docker socket хоста (`/var/run/docker.sock`), что фактически даёт контейнеру root-доступ к хосту;
- безопасно и полноценно запускать контейнерную инфраструктуру внутри ограниченного контейнера невозможно без ослабления изоляции.

Следствие:

Контейнер как базовая среда несовместим с контейнером как целевой средой разработки.

Если агент должен:

- проектировать контейнерную архитектуру,
- собирать образы,
- запускать сервисы,
- тестировать оркестрацию,

его среда исполнения должна быть:

- либо физической машиной,
- либо полноценной виртуальной машиной.

### 3.2. Почему выбрана виртуальная машина

Виртуальная машина обеспечивает:

- жёсткие лимиты CPU, RAM и диска;
- высокий барьер выхода за пределы среды;
- минимальное влияние на хост-систему;
- возможность безопасно запускать Docker внутри себя;
- корректную модель современной разработки.

Виртуальная машина используется не только из-за более строгой изоляции, но и потому что она не ломает архитектурную целостность DevOps-процесса.

---

## 4. Выбор Multipass

Выбор сделан в пользу Multipass (Ubuntu-VM) по следующим причинам:

- простота запуска;
- минимальный порог входа;
- отсутствие необходимости вручную писать сложные конфигурации (в отличие от Vagrant);
- ориентация на массового пользователя.

Ограничения (например, отсутствие RPM-дистрибутивов) считаются допустимыми, поскольку:

- Ubuntu/Debian покрывают большую часть пользовательских сценариев;
- при необходимости внутри VM можно использовать Docker для специфических задач.

---

## 5. Принципы системы

### 5.1. Безопасность по умолчанию

- Агент работает изолированно.
- Ресурсы ограничены.
- Данные пользователя не доступны напрямую.
- Все потенциально опасные операции происходят внутри VM.
- Автоматическое резервное копирование из коробки.

### 5.2. Прозрачность состояния

Пользователь должен видеть:

- какие VM запущены;
- какие из них принадлежат системе;
- какие папки примонтированы;
- какие агенты активны;
- какие процессы работают;
- сколько используется CPU/RAM;
- какие порты проброшены;
- работают ли резервные копии.

### 5.3. Контроль инфраструктуры

Система включает:

- создание и управление VM;
- генерацию независимых SSH-ключей;
- проброс портов через SSH (без привязки к плавающему IP);
- поддержку SOCKS-proxy;
- systemd-демон, управляющий:
  - резервным копированием,
  - процессами агентов,
  - порт-форвардингом,
  - мониторингом состояния,
  - выводом централизованного статуса системы.

---

## 6. Отношение к резервным копиям

Резервные копии являются базовым элементом архитектуры безопасности.

### 6.1. Резервные копии по умолчанию

- Резервное копирование включено автоматически.
- Пользователь не обязан помнить о необходимости включить защиту.
- Отсутствие резервных копий не является состоянием по умолчанию.

### 6.2. Автоматичность и независимость

- Резервное копирование может работать независимо от жизненного цикла агента.
- Агент может быть одноразовым.
- Резервные копии могут выполняться непрерывно или по расписанию.
- Запуск и остановка агента не обязаны влиять на механизм защиты данных.

### 6.3. Осознанное отключение

- Отключение возможно.
- Требует явной настройки.
- Не происходит случайно.
- Не является поведением по умолчанию.

---

## 7. TODO: Простота установки

Текущая установка через `pip` неудобна для системного инструмента с демоном.

Цель:

- сделать установку системной;
- минимизировать ручную настройку;
- распространение через Snap (логично, так как Multipass распространяется через snap).

В перспективе:

- поддержка Windows (через WSL),
- поддержка macOS (через альтернативную систему пакетов, например brew).

---

## 8. Ключевая философская позиция проекта

1. ИИ-агенты неизбежно опасны.
2. Встроенные песочницы недостаточны.
3. Контейнеры — компромисс, а не полноценная изоляция.
4. Полноценная виртуальная машина — минимально приемлемый уровень безопасности.
5. Пользователь не должен становиться DevOps-инженером ради безопасного запуска агента.
6. Безопасность, прозрачность и управляемость важнее максимальной производительности.
7. Резервные копии должны быть автоматическими и обязательными по умолчанию.

---

## 9. Формула проекта

Проект — это:

Упрощённая, системно управляемая, изолированная среда запуска ИИ-агентов, ориентированная на обычного пользователя и построенная вокруг виртуальной машины как базовой единицы безопасности.
